<!DOCTYPE html>
<!-- å®£å‘Šæ–‡ä»¶é¡å‹ç‚º HTML5 -->
<html lang="zh-TW">
<!-- è¨­å®šç¶²é ä¸»è¦èªè¨€ç‚ºç¹é«”ä¸­æ–‡ -->
<head>
    <!-- è¨­å®šå­—å…ƒç·¨ç¢¼ç‚º UTF-8ï¼Œé˜²æ­¢ä¸­æ–‡é¡¯ç¤ºäº‚ç¢¼ -->
    <meta charset="UTF-8">
    <!-- è¨­å®šè¦–å£ (Viewport)ï¼Œè®“ç¶²é å¯¬åº¦ç¬¦åˆè£ç½®å¯¬åº¦ï¼Œå¯¦ç¾ RWD éŸ¿æ‡‰å¼è¨­è¨ˆ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <!-- ç¶²é æ¨™é¡Œï¼Œé¡¯ç¤ºåœ¨ç€è¦½å™¨åˆ†é æ¨™ç±¤ä¸Š -->
    <title>Pocket Dashboard å£è¢‹å„€è¡¨æ¿</title>
    
    <!-- CSS æ¨£å¼è¡¨å€åŸŸ -->
    <style>
        /* --- é€é Gemini åœ¨ä¸å½±éŸ¿æ¨¡çµ„åŠŸèƒ½ä¸”ä¸æ”¹å¯« JavaScript æƒ…æ³ä¸‹ï¼Œå”åŠ©å„ªåŒ–å‰ç«¯ä»‹é¢ --- */
        
        /* è¨­å®šå…¨åŸŸæ¨£å¼ */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* è¨­å®šå„ªå…ˆä½¿ç”¨çš„å­—é«” */
            text-align: center; /* è®“æ‰€æœ‰æ–‡å­—å…§å®¹ç½®ä¸­å°é½Š */
            background: #e0f7fa; /* è¨­å®šèƒŒæ™¯é¡è‰²ç‚ºæ·ºè—è‰² */
            padding: 20px; /* è¨­å®šå…§è·ï¼Œé¿å…å…§å®¹è²¼é½Šé‚Šç·£ */
            color: #333; /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºæ·±ç°è‰² */
        }
        
        /* è¨­å®šä¸»æ¨™é¡Œæ¨£å¼ */
        h1 { 
            color: #006064; /* è¨­å®šæ¨™é¡Œé¡è‰²ç‚ºæ·±é’è‰² */
            margin-bottom: 5px; /* è¨­å®šä¸‹æ–¹é‚Šè· */
            letter-spacing: 1px; /* å¢åŠ å­—å…ƒé–“è· */
        }

        /* è¨­å®šå‰¯æ¨™é¡Œæ¨£å¼ */
        p.subtitle { 
            color: #546e7a; /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºç°è—è‰² */
            margin-bottom: 30px; /* å¢åŠ ä¸‹æ–¹é‚Šè·ï¼Œèˆ‡å¡ç‰‡æ‹‰é–‹è·é›¢ */
            font-weight: 500; /* è¨­å®šå­—é«”ç²—ç´° */
        }
        
        /* è¨­å®šå¡ç‰‡å®¹å™¨æ¨£å¼ (æ¯å€‹åŠŸèƒ½å€å¡Š) */
        .card { 
            background: white; /* å¡ç‰‡èƒŒæ™¯ç‚ºç™½è‰² */
            padding: 25px; /* å¡ç‰‡å…§éƒ¨ä¿ç•™ç©ºé–“ */
            border-radius: 20px; /* è¨­å®šåœ“è§’æ•ˆæœ */
            box-shadow: 0 10px 20px rgba(0,0,0,0.08); /* åŠ å…¥é™°å½±è®“å¡ç‰‡æµ®èµ·ä¾† */
            margin-bottom: 20px; /* å¡ç‰‡ä¹‹é–“çš„è·é›¢ */
            max-width: 400px; /* é™åˆ¶å¡ç‰‡æœ€å¤§å¯¬åº¦ */
            margin-left: auto; /* æ°´å¹³è‡ªå‹•ç½®ä¸­ */
            margin-right: auto; /* æ°´å¹³è‡ªå‹•ç½®ä¸­ */
            transition: transform 0.2s; /* è¨­å®šè®Šå½¢å‹•ç•«çš„éæ¸¡æ™‚é–“ */
        }

        /* ç•¶æ»‘é¼ ç§»éå¡ç‰‡æ™‚çš„æ•ˆæœ */
        .card:hover { 
            transform: translateY(-5px); /* è®“å¡ç‰‡å¾€ä¸Šæµ®å‹• 5px */
        }
        
        /* è¨­å®šå¡ç‰‡å…§çš„å°æ¨™é¡Œæ¨£å¼ */
        h2 { 
            margin-top: 0; /* ç§»é™¤ä¸Šæ–¹é‚Šè· */
            color: #00838f; /* è¨­å®šé¡è‰² */
            border-bottom: 2px solid #b2dfdb; /* åº•éƒ¨åŠ ä¸Šè£é£¾ç·š */
            padding-bottom: 10px; /* æ¨™é¡Œèˆ‡è£é£¾ç·šçš„è·é›¢ */
            font-size: 1.2rem; /* è¨­å®šå­—é«”å¤§å° */
        }

        /* è¨­å®šæ•¸æ“šé¡¯ç¤ºçš„æ¨£å¼ (å¦‚æº«åº¦ã€ç¶“ç·¯åº¦) */
        .data { 
            font-size: 28px; /* æ”¾å¤§å­—é«” */
            font-weight: bold; /* ç²—é«” */
            color: #2c3e50; /* æ·±è—è‰² */
            margin: 15px 0; /* ä¸Šä¸‹é‚Šè· */
        }

        /* è¨­å®šæ¨™ç±¤èªªæ˜æ–‡å­—çš„æ¨£å¼ */
        .label { 
            font-size: 14px; /* è¼ƒå°çš„å­—é«” */
            color: #7f8c8d; /* ç°è‰² */
        }
        
        /* è¨­å®š Google Maps æŒ‰éˆ•æ¨£å¼ */
        #map-link {
            display: none; /* é è¨­éš±è—ï¼Œå®šä½æˆåŠŸå¾Œæ‰é¡¯ç¤º */
            background-color: #4285F4; /* Google å®˜æ–¹è—è‰² */
            color: white; /* æ–‡å­—ç™½è‰² */
            text-decoration: none; /* ç§»é™¤è¶…é€£çµåº•ç·š */
            padding: 12px 25px; /* æŒ‰éˆ•å…§è· */
            border-radius: 50px; /* è† å›Šç‹€åœ“è§’ */
            font-weight: bold; /* ç²—é«”æ–‡å­— */
            margin-top: 15px; /* ä¸Šæ–¹é‚Šè· */
            box-shadow: 0 4px 6px rgba(66, 133, 244, 0.3); /* æŒ‰éˆ•é™°å½± */
            transition: all 0.2s; /* æ‰€æœ‰å±¬æ€§è®ŠåŒ–éƒ½æœ‰éæ¸¡æ•ˆæœ */
        }

        /* ç•¶æŒ‰ä¸‹æŒ‰éˆ•æ™‚çš„æ•ˆæœ */
        #map-link:active { 
            transform: scale(0.95); /* ç¨å¾®ç¸®å°ï¼Œç”¢ç”ŸæŒ‰å£“æ„Ÿ */
            box-shadow: 0 2px 4px rgba(66, 133, 244, 0.2); /* é™°å½±è®Šå° */
        }

        /* è¨­å®šæŒ‡å—é‡ç®­é ­æ¨£å¼ */
        #compass-arrow { 
            font-size: 60px; /* æ”¾å¤§ç®­é ­åœ–ç¤º */
            display: inline-block; /* è¨­å®šç‚ºå€å¡Šå…ƒç´ ä»¥ä¾¿æ—‹è½‰ */
            /* è¨­å®šæ—‹è½‰å‹•ç•«æ›²ç·šï¼Œè®“è½‰å‹•æ›´è‡ªç„¶ */
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }

        /* è¨­å®šå•Ÿç”¨æ„Ÿæ¸¬å™¨æŒ‰éˆ•æ¨£å¼ */
        .btn-start { 
            background: #00838f; /* æ·±é’è‰²èƒŒæ™¯ */
            color: white; /* ç™½è‰²æ–‡å­— */
            border: none; /* ç§»é™¤é‚Šæ¡† */
            padding: 10px 20px; /* å…§è· */
            border-radius: 8px; /* åœ“è§’ */
            font-size: 15px; /* å­—é«”å¤§å° */
            cursor: pointer; /* æ»‘é¼ æ¸¸æ¨™è®Šç‚ºæ‰‹æŒ‡ */
            margin-top: 10px; /* ä¸Šæ–¹é‚Šè· */
        }
    </style>
</head>
<body>

    <!-- ç¶²é ä¸»æ¨™é¡Œ -->
    <h1>å£è¢‹å„€è¡¨æ¿ ğŸ“± Pocket Dashboard</h1>
    <!-- å‰¯æ¨™é¡Œ -->
    <p class="subtitle">éš¨èº«ç’°å¢ƒåµæ¸¬ç³»çµ±</p>

    <!-- åŠŸèƒ½å€å¡Š 1ï¼šGPS å®šä½è³‡è¨Š -->
    <div class="card">
        <h2>ğŸ“ æˆ‘çš„ä½ç½® (GPS)</h2>
        <!-- ç‹€æ…‹é¡¯ç¤ºå€åŸŸ -->
        <div id="gps-status" class="label">ğŸ“¡ æ­£åœ¨æ¥æ”¶è¡›æ˜Ÿè¨Šè™Ÿ...</div>
        
        <!-- ç¶“ç·¯åº¦æ•¸å€¼é¡¯ç¤ºå€åŸŸ -->
        <div class="data">
            <span id="lat">--</span>, <span id="lon">--</span>
        </div>
        <!-- ä¸­æ–‡åœ°å€é¡¯ç¤ºå€åŸŸ -->
        <div id="address" class="label" style="color: #e91e63; font-weight: bold; min-height: 20px;"></div>

        <!-- Google Maps é€£çµæŒ‰éˆ• (é è¨­éš±è—) -->
        <a id="map-link" href="#" target="_blank">ğŸ—ºï¸ é–‹å•Ÿ Google åœ°åœ–</a>
    </div>

    <!-- åŠŸèƒ½å€å¡Š 2ï¼šå¤©æ°£è³‡è¨Š -->
    <div class="card">
        <h2>â˜ï¸ ç•¶åœ°å¤©æ°£ (API)</h2>
        <div class="data">
            <!-- æº«åº¦æ•¸å€¼ -->
            <span id="temp">--</span>Â°C
        </div>
        <!-- é¢¨é€Ÿæ•¸å€¼ -->
        <div class="label">ğŸ’¨ é¢¨é€Ÿ: <span id="wind">--</span> km/h</div>
    </div>

    <!-- åŠŸèƒ½å€å¡Š 3ï¼šé›»å­ç¾…ç›¤ -->
    <div class="card">
        <h2>ğŸ§­ é›»å­ç¾…ç›¤</h2>
        <!-- æŒ‡å—é‡ç®­é ­åœ–ç¤º -->
        <div id="compass-arrow">â¬†ï¸</div>
        <!-- è§’åº¦æ•¸å€¼ -->
        <div class="data"><span id="alpha">0</span>Â°</div>
        <div class="label">è«‹å¹³æ”¾æ‰‹æ©Ÿä¸¦æ—‹è½‰</div>
        <!-- iOS æˆæ¬ŠæŒ‰éˆ• -->
        <button class="btn-start" onclick="requestOrientation()">å•Ÿç”¨æ„Ÿæ¸¬å™¨ (iOS)</button>
    </div>

    <!-- JavaScript ç¨‹å¼é‚è¼¯å€åŸŸ -->
    <script>
        // å®šç¾©å•Ÿå‹• GPS çš„å‡½å¼
        function startGPS() {
            // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Geolocation API
            if ("geolocation" in navigator) {
                // å‘¼å« getCurrentPosition å–å¾—ç•¶å‰ä½ç½®ï¼Œé€™æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œ
                navigator.geolocation.getCurrentPosition(async (position) => {
                    // å¾å›å‚³çš„ position ç‰©ä»¶ä¸­å–å¾—ç·¯åº¦
                    const lat = position.coords.latitude;
                    // å¾å›å‚³çš„ position ç‰©ä»¶ä¸­å–å¾—ç¶“åº¦
                    const lon = position.coords.longitude;

                    // å°‡ç·¯åº¦é¡¯ç¤ºåœ¨ç¶²é ä¸Šï¼Œä¸¦ä½¿ç”¨ toFixed(4) å–å°æ•¸é»å¾Œ 4 ä½
                    document.getElementById('lat').innerText = lat.toFixed(4);
                    // å°‡ç¶“åº¦é¡¯ç¤ºåœ¨ç¶²é ä¸Šï¼Œä¸¦å–å°æ•¸é»å¾Œ 4 ä½
                    document.getElementById('lon').innerText = lon.toFixed(4);
                    // æ›´æ–°å®šä½ç‹€æ…‹æ–‡å­—ç‚ºæˆåŠŸ
                    document.getElementById('gps-status').innerText = "âœ… å®šä½é–å®š";

                    // --- é¡å¤–å¢åŠ  Google Maps ä¸²è¯ï¼Œè®“ä½¿ç”¨æ›´ç‚ºç›´è§€ ---
                    // å–å¾—åœ°åœ–æŒ‰éˆ•å…ƒç´ 
                    const mapLink = document.getElementById('map-link');
                    // è¨­å®šæŒ‰éˆ•çš„é€£çµç¶²å€ï¼Œå¸¶å…¥ç¶“ç·¯åº¦åƒæ•¸ (query string)
                    mapLink.href = `https://www.google.com/maps?q=${lat},${lon}`;
                    // å°‡æŒ‰éˆ•çš„é¡¯ç¤ºæ¨£å¼å¾ none æ”¹ç‚º inline-block (é¡¯ç¤ºå‡ºä¾†)
                    mapLink.style.display = "inline-block";

                    // å‘¼å«å¤©æ°£æŸ¥è©¢å‡½å¼ï¼Œä½¿ç”¨ await ç­‰å¾…çµæœ
                    await fetchWeather(lat, lon);
                    // å‘¼å«åœ°å€æŸ¥è©¢å‡½å¼ï¼Œä½¿ç”¨ await ç­‰å¾…çµæœ
                    await fetchAddress(lat, lon);

                }, (err) => {
                    // å¦‚æœå®šä½å¤±æ•— (ä¾‹å¦‚ä½¿ç”¨è€…æ‹’çµ•)ï¼ŒåŸ·è¡Œæ­¤å€å¡Š
                    document.getElementById('gps-status').innerText = "âŒ ç„¡æ³•å®šä½";
                    // è·³å‡ºè­¦å‘Šè¦–çª—æé†’ä½¿ç”¨è€…
                    alert("è«‹å…è¨± GPS æ¬Šé™ä»¥ä½¿ç”¨å„€è¡¨æ¿åŠŸèƒ½ã€‚");
                });
            } else {
                // å¦‚æœç€è¦½å™¨ä¸æ”¯æ´ GPSï¼Œè·³å‡ºè­¦å‘Š
                alert("ç€è¦½å™¨ä¸æ”¯æ´ GPS");
            }
        }

        // å®šç¾©æŸ¥è©¢å¤©æ°£çš„éåŒæ­¥å‡½å¼ (ä½¿ç”¨ Open-Meteo API)
        async function fetchWeather(lat, lon) {
            // æº–å‚™ API è«‹æ±‚ç¶²å€ï¼ŒåŒ…å«ç¶“ç·¯åº¦åƒæ•¸
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
            // ä½¿ç”¨ fetch ç™¼é€ç¶²è·¯è«‹æ±‚ï¼Œä¸¦ç­‰å¾…å›æ‡‰
            const response = await fetch(url);
            // å°‡å›æ‡‰å…§å®¹è½‰æ›ç‚º JSON æ ¼å¼
            const data = await response.json();
            // å¾ JSON è³‡æ–™ä¸­æå–æº«åº¦ï¼Œæ›´æ–°åˆ°ç¶²é 
            document.getElementById('temp').innerText = data.current_weather.temperature;
            // å¾ JSON è³‡æ–™ä¸­æå–é¢¨é€Ÿï¼Œæ›´æ–°åˆ°ç¶²é 
            document.getElementById('wind').innerText = data.current_weather.windspeed;
            }
        
        // å®šç¾©æŸ¥è©¢åœ°å€çš„éåŒæ­¥å‡½å¼ (ä½¿ç”¨ OpenStreetMap Nominatim API)
        async function fetchAddress(lat, lon) {
            // æº–å‚™ API è«‹æ±‚ç¶²å€ï¼Œè¨­å®š format ç‚º json
            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
            // ä½¿ç”¨ fetch ç™¼é€ç¶²è·¯è«‹æ±‚ï¼Œä¸¦ç­‰å¾…å›æ‡‰
            const response = await fetch(url);
            // å°‡å›æ‡‰å…§å®¹è½‰æ›ç‚º JSON æ ¼å¼
            const data = await response.json();
            // å¾ JSON è³‡æ–™ä¸­æå–é¡¯ç¤ºåç¨± (display_name)ï¼Œæ›´æ–°åˆ°ç¶²é 
            document.getElementById('address').innerText = data.display_name;
            } 

        // å®šç¾©è«‹æ±‚è£ç½®æ–¹å‘æ¬Šé™çš„å‡½å¼ (é‡å° iOS 13+ å®‰å…¨æ€§è¦æ±‚)
        function requestOrientation() {
            // æª¢æŸ¥æ˜¯å¦ç‚º iOS è£ç½® (æ˜¯å¦æœ‰ requestPermission æ–¹æ³•)
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                // å‘¼å«è«‹æ±‚æ¬Šé™çš„æ–¹æ³•
                DeviceOrientationEvent.requestPermission()
                    // ä½¿ç”¨ Promise è™•ç†ä½¿ç”¨è€…çš„é¸æ“‡
                    .then(response => {
                        // å¦‚æœä½¿ç”¨è€…å…è¨± (granted)
                        if (response == 'granted') window.addEventListener('deviceorientation', handleOrientation);
                        // å¦‚æœä½¿ç”¨è€…æ‹’çµ•ï¼Œè·³å‡ºè­¦å‘Š
                        else alert("æˆæ¬Šè¢«æ‹’çµ•");
                    })
                    // æ•æ‰å¯èƒ½çš„éŒ¯èª¤
                    .catch(console.error);
            } else {
                // å¦‚æœæ˜¯ Android æˆ–ä¸€èˆ¬é›»è…¦ï¼Œç›´æ¥åŠ å…¥ç›£è½å™¨ï¼Œä¸éœ€è¦è«‹æ±‚æ¬Šé™
                window.addEventListener('deviceorientation', handleOrientation);
            }
        }

        // è™•ç†è£ç½®æ–¹å‘æ”¹è®Šçš„äº‹ä»¶å‡½å¼
        function handleOrientation(event) {
            // å–å¾— Z è»¸æ—‹è½‰è§’åº¦ (alpha)ï¼Œç¯„åœ 0 åˆ° 360 åº¦
            const alpha = event.alpha;
            // ç¢ºä¿ alpha å€¼å­˜åœ¨
            if (alpha !== null) {
                // æ›´æ–°ç¶²é ä¸Šçš„è§’åº¦æ•¸å€¼ï¼Œä¸¦å››æ¨äº”å…¥
                document.getElementById('alpha').innerText = Math.round(alpha);
                // è¨­å®š CSS transform å±¬æ€§ä¾†æ—‹è½‰ç®­é ­åœ–ç‰‡
                // 360 - alpha æ˜¯ç‚ºäº†åå‘æ—‹è½‰ï¼Œè®“ç®­é ­è¦–è¦ºä¸Šä¿æŒæŒ‡å‘åŒ—æ–¹
                document.getElementById('compass-arrow').style.transform = `rotate(${360 - alpha}deg)`;
            }
        }

        // ç¨‹å¼é€²å…¥é»ï¼šåŸ·è¡Œ startGPS å‡½å¼é–‹å§‹é‹ä½œ
        startGPS();
    </script>
</body>
</html>
