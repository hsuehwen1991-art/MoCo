<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket Scout - éš¨èº«ç’°å¢ƒåµæ¸¬</title>
    <style>
        /* ç°¡å–®æ¸…çˆ½çš„ CSS æ¨£å¼ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #e0f7fa; padding: 20px; color: #333; }
        h1 { color: #00695c; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 30px; }
        
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        h2 { margin-top: 0; color: #00796b; border-bottom: 2px solid #b2dfdb; padding-bottom: 10px; }
        .data { font-size: 28px; font-weight: bold; color: #2c3e50; margin: 15px 0; }
        .label { font-size: 14px; color: #7f8c8d; }
        .sub-data { color: #e91e63; font-weight: bold; margin-top: 5px; }
        
        /* Google Maps æŒ‰éˆ•æ¨£å¼ (æ–¹æ³•ä¸€çš„æ ¸å¿ƒ) */
        #map-link {
            display: none; /* é è¨­éš±è—ï¼Œå®šä½æˆåŠŸæ‰é¡¯ç¤º */
            background-color: #4285F4; /* Google Blue */
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            margin-top: 15px;
            box-shadow: 0 4px 6px rgba(66, 133, 244, 0.3);
            transition: transform 0.2s;
        }
        #map-link:active { transform: scale(0.95); }

        /* æŒ‡å—é‡å‹•ç•« */
        #compass-arrow { font-size: 60px; display: inline-block; transition: transform 0.3s ease-out; }
        
        /* å•Ÿç”¨æŒ‰éˆ• */
        .btn-start { background: #009688; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸš€ Pocket Scout</h1>
    <p>æ‚¨çš„éš¨èº«ç’°å¢ƒå„€è¡¨æ¿</p>

    <div class="card">
        <h2>ğŸ“ æˆ‘çš„ä½ç½®</h2>
        <div id="gps-status" class="label">æ­£åœ¨ç­‰å¾…å®šä½...</div>
        
        <div class="data">
            <span id="lat">--</span>, <span id="lon">--</span>
        </div>
        <div id="address" class="sub-data">(æ­£åœ¨æŸ¥è©¢åœ°å€...)</div>

        <a id="map-link" href="#" target="_blank">ğŸ—ºï¸ é–‹å•Ÿ Google åœ°åœ–</a>
    </div>

    <div class="card">
        <h2>â˜ï¸ ç•¶åœ°å¤©æ°£</h2>
        <div class="data">
            <span id="temp">--</span>Â°C
        </div>
        <div class="label">é¢¨é€Ÿ: <span id="wind">--</span> km/h</div>
    </div>

    <div class="card">
        <h2>ğŸ§­ é›»å­ç¾…ç›¤</h2>
        <div id="compass-arrow">â¬†ï¸</div>
        <div class="data"><span id="alpha">0</span>Â°</div>
        <div class="label">æ‰‹æ©Ÿè«‹å¹³æ”¾ä¸¦æ—‹è½‰</div>
        <button class="btn-start" onclick="requestOrientation()">å•Ÿç”¨ç¾…ç›¤ (iOS å¿…é»)</button>
    </div>

    <script>
        // --- 1. å•Ÿå‹• GPS (è¡Œå‹•è¦ç´ ) ---
        // åƒè€ƒæ•™æï¼šEx02/05 çµåˆä½ç½®æœå‹™èˆ‡æ„Ÿæ¸¬è³‡æ–™
        function startGPS() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // é¡¯ç¤ºç¶“ç·¯åº¦
                    document.getElementById('lat').innerText = lat.toFixed(4);
                    document.getElementById('lon').innerText = lon.toFixed(4);
                    document.getElementById('gps-status').innerText = "âœ… å®šä½æˆåŠŸ";

                    // ã€æ–¹æ³•ä¸€æ ¸å¿ƒç¨‹å¼ç¢¼ã€‘è¨­å®š Google Maps é€£çµ
                    const mapLink = document.getElementById('map-link');
                    // è¨­å®š href å±¬æ€§ï¼Œq=ç·¯åº¦,ç¶“åº¦
                    mapLink.href = `https://www.google.com/maps?q=${lat},${lon}`;
                    // è®“æŒ‰éˆ•é¡¯ç¤ºå‡ºä¾†
                    mapLink.style.display = "inline-block";

                    // å–å¾—ä½ç½®å¾Œï¼Œç«‹åˆ»è§¸ç™¼ API æŸ¥è©¢ (é€šè¨Šè¦ç´ )
                    await fetchWeather(lat, lon);
                    await fetchAddress(lat, lon);

                }, (err) => {
                    document.getElementById('gps-status').innerText = "âŒ å®šä½å¤±æ•—: " + err.message;
                    alert("ç„¡æ³•å–å¾—ä½ç½®ï¼Œè«‹ç¢ºèªæ‰‹æ©Ÿ GPS å·²é–‹å•Ÿä¸¦å…è¨±æˆæ¬Šã€‚");
                });
            } else {
                alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ GPS");
            }
        }

        // --- 2. æŸ¥è©¢å¤©æ°£ (é€šè¨Šè¦ç´  - Fetch) ---
        // åƒè€ƒæ•™æï¼šEx03/01 Fetch
        async function fetchWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                document.getElementById('temp').innerText = data.current_weather.temperature;
                document.getElementById('wind').innerText = data.current_weather.windspeed;
            } catch (e) {
                console.error("å¤©æ°£ API éŒ¯èª¤", e);
            }
        }

        // --- 3. æŸ¥è©¢åœ°å€ (é€šè¨Šè¦ç´  - Fetch) ---
        async function fetchAddress(lat, lon) {
            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                // ç°¡åŒ–åœ°å€é¡¯ç¤º (å–å‰å¹¾å€‹å­—å…ƒé¿å…å¤ªé•·ï¼Œæˆ–ç›´æ¥é¡¯ç¤º full address)
                document.getElementById('address').innerText = data.display_name;
            } catch (e) {
                console.error("åœ°å€ API éŒ¯èª¤", e);
                document.getElementById('address').innerText = "åœ°å€æŸ¥è©¢å¤±æ•—";
            }
        }

        // --- 4. é›»å­ç¾…ç›¤ (è¡Œå‹•è¦ç´ ) ---
        // åƒè€ƒæ•™æï¼šEx02/04 è£ç½®æ„Ÿæ¸¬å™¨æ•´åˆ
        function requestOrientation() {
            // iOS 13+ éœ€è¦ä½¿ç”¨è€…æˆæ¬Š
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        } else {
                            alert("æˆæ¬Šè¢«æ‹’çµ•");
                        }
                    })
                    .catch(console.error);
            } else {
                // Android æˆ–ä¸€èˆ¬ç€è¦½å™¨ç›´æ¥ç›£è½
                window.addEventListener('deviceorientation', handleOrientation);
            }
        }

        function handleOrientation(event) {
            const alpha = event.alpha; // Z è»¸æ—‹è½‰è§’åº¦ (0-360)
            if (alpha !== null) {
                document.getElementById('alpha').innerText = Math.round(alpha);
                // æ—‹è½‰ç®­é ­ï¼š360 - alpha è®“ç®­é ­ä¿æŒæŒ‡å‘åŒ—æ–¹
                document.getElementById('compass-arrow').style.transform = `rotate(${360 - alpha}deg)`;
            }
        }

        // é é¢è¼‰å…¥å¾Œè‡ªå‹•å•Ÿå‹• GPS
        startGPS();

    </script>
</body>
</html>
