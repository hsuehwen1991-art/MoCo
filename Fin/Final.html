<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Pocket Dashboard å£è¢‹å„€è¡¨æ¿</title>
    <style>
        /* --- é€éGeminiåœ¨ä¸å½±éŸ¿æ¨¡çµ„åŠŸèƒ½ä¸”ä¸æ”¹å¯«JavaScriptæƒ…æ³ä¸‹ï¼Œå”åŠ©å„ªåŒ–å‰ç«¯ä»‹é¢ --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #e0f7fa; padding: 20px; color: #333; }
        
        h1 { color: #006064; margin-bottom: 5px; letter-spacing: 1px; }
        p.subtitle { color: #546e7a; margin-bottom: 30px; font-weight: 500; }
        
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.08); 
            margin-bottom: 20px; 
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-5px); }
        
        h2 { margin-top: 0; color: #00838f; border-bottom: 2px solid #b2dfdb; padding-bottom: 10px; font-size: 1.2rem; }
        .data { font-size: 28px; font-weight: bold; color: #2c3e50; margin: 15px 0; }
        .label { font-size: 14px; color: #7f8c8d; }
        
        #map-link {
            display: none; 
            background-color: #4285F4; 
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            margin-top: 15px;
            box-shadow: 0 4px 6px rgba(66, 133, 244, 0.3);
            transition: all 0.2s;
        }
        #map-link:active { transform: scale(0.95); box-shadow: 0 2px 4px rgba(66, 133, 244, 0.2); }

        #compass-arrow { font-size: 60px; display: inline-block; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .btn-start { background: #00838f; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 15px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>å£è¢‹å„€è¡¨æ¿ ğŸ“± Pocket Dashboard</h1>
    <p class="subtitle">éš¨èº«ç’°å¢ƒåµæ¸¬ç³»çµ±</p>

    <div class="card">
        <h2>ğŸ“ æˆ‘çš„ä½ç½® (GPS)</h2>
        <div id="gps-status" class="label">ğŸ“¡ æ­£åœ¨æ¥æ”¶è¡›æ˜Ÿè¨Šè™Ÿ...</div>
        
        <div class="data">
            <span id="lat">--</span>, <span id="lon">--</span>
        </div>
        <div id="address" class="label" style="color: #e91e63; font-weight: bold; min-height: 20px;"></div>

        <a id="map-link" href="#" target="_blank">ğŸ—ºï¸ é–‹å•Ÿ Google åœ°åœ–</a>
    </div>

    <div class="card">
        <h2>â˜ï¸ ç•¶åœ°å¤©æ°£ (API)</h2>
        <div class="data">
            <span id="temp">--</span>Â°C
        </div>
        <div class="label">ğŸ’¨ é¢¨é€Ÿ: <span id="wind">--</span> km/h</div>
    </div>

    <div class="card">
        <h2>ğŸ§­ é›»å­ç¾…ç›¤</h2>
        <div id="compass-arrow">â¬†ï¸</div>
        <div class="data"><span id="alpha">0</span>Â°</div>
        <div class="label">è«‹å¹³æ”¾æ‰‹æ©Ÿä¸¦æ—‹è½‰</div>
        <button class="btn-start" onclick="requestOrientation()">å•Ÿç”¨æ„Ÿæ¸¬å™¨ (iOS)</button>
    </div>

    <script>
        function startGPS() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    document.getElementById('lat').innerText = lat.toFixed(4);
                    document.getElementById('lon').innerText = lon.toFixed(4);
                    document.getElementById('gps-status').innerText = "âœ… å®šä½é–å®š";

                    // é¡å¤–å¢åŠ Google Mapsä¸²è¯ï¼Œè®“ä½¿ç”¨æ›´ç‚ºç›´è§€
                    const mapLink = document.getElementById('map-link');
                    mapLink.href = `https://www.google.com/maps?q=${lat},${lon}`;
                    mapLink.style.display = "inline-block";

                    await fetchWeather(lat, lon);
                    await fetchAddress(lat, lon);

                }, (err) => {
                    document.getElementById('gps-status').innerText = "âŒ ç„¡æ³•å®šä½";
                    alert("è«‹å…è¨± GPS æ¬Šé™ä»¥ä½¿ç”¨å„€è¡¨æ¿åŠŸèƒ½ã€‚");
                });
            } else {
                alert("ç€è¦½å™¨ä¸æ”¯æ´ GPS");
            }
        }

        async function fetchWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
            const response = await fetch(url);
            const data = await response.json();
            document.getElementById('temp').innerText = data.current_weather.temperature;
            document.getElementById('wind').innerText = data.current_weather.windspeed;
            }
        
        async function fetchAddress(lat, lon) {
            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
            const response = await fetch(url);
            const data = await response.json();
            document.getElementById('address').innerText = data.display_name;
            } 

        function requestOrientation() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') window.addEventListener('deviceorientation', handleOrientation);
                        else alert("æˆæ¬Šè¢«æ‹’çµ•");
                    })
                    .catch(console.error);
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }
        }

        function handleOrientation(event) {
            const alpha = event.alpha;
            if (alpha !== null) {
                document.getElementById('alpha').innerText = Math.round(alpha);
                document.getElementById('compass-arrow').style.transform = `rotate(${360 - alpha}deg)`;
            }
        }

        startGPS();
    </script>
</body>
</html>
